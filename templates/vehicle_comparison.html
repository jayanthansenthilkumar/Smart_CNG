<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Comparison - Smart CNG</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .comparison-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .vehicle-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .vehicle-input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .input-group input, .input-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .comparison-results {
            display: none;
            margin-top: 30px;
        }

        .vehicle-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .vehicle-card.best {
            border: 3px solid #4CAF50;
        }

        .rank-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .rank-1 { background: #4CAF50; }
        .rank-2 { background: #2196F3; }
        .rank-3 { background: #FF9800; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .environmental-impact {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="comparison-container">
        <h1>ðŸš— Vehicle Comparison Tool</h1>
        <p>Compare fuel costs across different vehicles and fuel types</p>

        <div class="vehicle-form">
            <h2>Add Vehicles to Compare</h2>
            <div id="vehicles-container"></div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="addVehicle()">+ Add Another Vehicle</button>
            </div>

            <div style="margin-top: 30px;">
                <div class="input-group">
                    <label>Monthly Distance (km)</label>
                    <input type="number" id="monthly-distance" value="1000" min="1">
                </div>
                
                <div class="input-group" style="margin-top: 15px;">
                    <label>Comparison Period (months)</label>
                    <input type="number" id="period-months" value="12" min="1" max="60">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="compareVehicles()">Compare Vehicles</button>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing vehicles...</p>
        </div>

        <div id="comparison-results" class="comparison-results"></div>
    </div>

    <script>
        let vehicleCount = 0;

        // Add initial vehicles
        window.onload = function() {
            addVehicle();
            addVehicle();
        };

        function addVehicle() {
            vehicleCount++;
            const container = document.getElementById('vehicles-container');
            const vehicleDiv = document.createElement('div');
            vehicleDiv.className = 'vehicle-input-row';
            vehicleDiv.id = `vehicle-${vehicleCount}`;
            vehicleDiv.innerHTML = `
                <div class="input-group">
                    <label>Vehicle Make</label>
                    <input type="text" class="vehicle-make" placeholder="e.g., Maruti" required>
                </div>
                <div class="input-group">
                    <label>Vehicle Model</label>
                    <input type="text" class="vehicle-model" placeholder="e.g., Swift" required>
                </div>
                <div class="input-group">
                    <label>Fuel Type</label>
                    <select class="vehicle-fuel">
                        <option value="petrol">Petrol</option>
                        <option value="diesel">Diesel</option>
                        <option value="cng">CNG</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Mileage (km/L or km/kg)</label>
                    <input type="number" class="vehicle-mileage" value="15" min="1" step="0.1" required>
                </div>
                <div class="input-group">
                    <button class="btn" style="background: #f44336; color: white; margin-top: 25px;" 
                            onclick="removeVehicle(${vehicleCount})">Remove</button>
                </div>
            `;
            container.appendChild(vehicleDiv);
        }

        function removeVehicle(id) {
            const vehicle = document.getElementById(`vehicle-${id}`);
            if (vehicle) {
                vehicle.remove();
            }
        }

        async function compareVehicles() {
            const vehicles = [];
            const vehicleRows = document.querySelectorAll('.vehicle-input-row');
            
            vehicleRows.forEach(row => {
                const make = row.querySelector('.vehicle-make').value;
                const model = row.querySelector('.vehicle-model').value;
                const fuel = row.querySelector('.vehicle-fuel').value;
                const mileage = parseFloat(row.querySelector('.vehicle-mileage').value);
                
                if (make && model && mileage) {
                    vehicles.push({
                        make: make,
                        model: model,
                        fuel_type: fuel,
                        mileage: mileage
                    });
                }
            });

            if (vehicles.length < 2) {
                alert('Please add at least 2 vehicles to compare');
                return;
            }

            const monthlyDistance = parseFloat(document.getElementById('monthly-distance').value);
            const periodMonths = parseInt(document.getElementById('period-months').value);

            document.getElementById('loading').style.display = 'block';
            document.getElementById('comparison-results').style.display = 'none';

            try {
                const response = await fetch('/api/compare-vehicles', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        vehicles: vehicles,
                        monthly_distance: monthlyDistance,
                        period_months: periodMonths,
                        city: 'Delhi'
                    })
                });

                const data = await response.json();
                displayResults(data);
            } catch (error) {
                alert('Error comparing vehicles: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('comparison-results');
            resultsDiv.style.display = 'block';
            
            let html = `
                <h2>Comparison Results (${data.period_months} months)</h2>
                <p>Monthly Distance: ${data.monthly_distance} km</p>
            `;

            data.comparisons.forEach((comp, index) => {
                const isBest = index === 0;
                html += `
                    <div class="vehicle-card ${isBest ? 'best' : ''}">
                        <span class="rank-badge rank-${comp.rank}">Rank #${comp.rank}</span>
                        ${isBest ? '<span style="color: #4CAF50; font-weight: bold; margin-left: 10px;">âœ“ Most Economical</span>' : ''}
                        
                        <h3>${comp.vehicle.make} ${comp.vehicle.model}</h3>
                        <p>Fuel Type: ${comp.vehicle.fuel_type.toUpperCase()} | Mileage: ${comp.vehicle.mileage} km/${comp.consumption.unit}</p>
                        
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-label">Monthly Cost</div>
                                <div class="stat-value">â‚¹${comp.costs.monthly}</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Total Cost (${data.period_months}m)</div>
                                <div class="stat-value">â‚¹${comp.costs.total}</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Cost per KM</div>
                                <div class="stat-value">â‚¹${comp.costs.per_km}</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Savings vs Highest</div>
                                <div class="stat-value" style="color: #4CAF50;">â‚¹${comp.cost_savings_vs_highest}</div>
                            </div>
                        </div>

                        <div class="environmental-impact">
                            <h4>ðŸŒ± Environmental Impact</h4>
                            <p>Monthly COâ‚‚: ${comp.environmental.monthly_co2} kg</p>
                            <p>Total COâ‚‚: ${comp.environmental.total_co2} kg</p>
                            <p>Trees needed to offset: ${comp.environmental.trees_equivalent}</p>
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>

